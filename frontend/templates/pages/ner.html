{% extends 'layouts/services.html' %}
{% block title %}Named Entity Recognition{% endblock %}
{% block content %}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script>
$(function() {
  $('input[name="type"]').on('click', function() {
    if ($(this).val() == 'url') {
      $('#textboxes').show();
    } else {
      $('#textboxes').hide();
    }

    if ($(this).val() == 'txt') {
      $('#textboxes1').show();
    } else {
      $('#textboxes1').hide();
    }
  });

});


$(document).ready(function () {

        function saveTextAsFile() {
            // grab the content of the form field and place it into a variable
            var textToWrite = document.getElementById("content").value;
            //  create a new Blob (html5 magic) that conatins the data from your form feild
            var textFileAsBlob = new Blob([textToWrite], { type: 'text/plain' });
            // Specify the name of the file to be saved
            var fileNameToSaveAs = "myNewFile.txt";

            // Optionally allow the user to choose a file name by providing
            // an imput field in the HTML and using the collected data here
            // var fileNameToSaveAs = txtFileName.text;

            // create a link for our script to 'click'
            var downloadLink = document.createElement("a");
            //  supply the name of the file (from the var above).
            // you could create the name here but using a var
            // allows more flexability later.
            downloadLink.download = fileNameToSaveAs;
            // provide text for the link. This will be hidden so you
            // can actually use anything you want.
            downloadLink.innerHTML = "My Hidden Link";

            // allow our code to work in webkit & Gecko based browsers
            // without the need for a if / else block.
            window.URL = window.URL || window.webkitURL;

            // Create the link Object.
            downloadLink.href = window.URL.createObjectURL(textFileAsBlob);
            // when link is clicked call a function to remove it from
            // the DOM in case user wants to save a second file.
            downloadLink.onclick = destroyClickedElement;
            // make sure the link is hidden.
            downloadLink.style.display = "none";
            // add the link to the DOM
            document.body.appendChild(downloadLink);

            // click the new link
            downloadLink.click();
        }

        function destroyClickedElement(event) {
            // remove the link from the DOM
            document.body.removeChild(event.target);
        }



        $("#download").click(function (e) {

            e.preventDefault();
            saveTextAsFile();
        });
 });

</script>
</head>
<body>

<div>
<h1>Named Entity Recognition</h1>
<p> <u>Description of the service:</u> </p>
<p> NER is probably the first step towards information extraction that seeks to locate and classify named entities in text into pre-defined categories such as the names of persons, organizations, locations, expressions of times, quantities, monetary values, percentages, etc. NER is used in many fields in Natural Language Processing. <br>
<br>
This online NER service for English uses SpaCy’s trained model to identify the named entities. Input can be either in text format or URL.
<br>
Note: In case of URL as input, output can be generated only if web-scrapping is permitted for that particular URL.</p>

<p> <u>Libraries and Resources used</u></p>
<p>SpaCy’s Named Entity Recognition model trained on  <a href="https://catalog.ldc.upenn.edu/LDC2013T19"> OntoNotes5</a>.<br/>
<p> <u>Author</u><br /> Ananya Mukherjee <br />ananya.mukherjee@research.iiit.ac.in</p>

<hr>
<h3> Choose your input</h3>
   <input type="radio" name="type" value="txt"> Enter Text
   <input type="radio" name="type" value="url"> Enter URL
</div>


<form action="{{ url_for('services.ner_call') }}" method="post" id="ner">

<div id="textboxes" style="display: none">
Input URL: <input class="form-control" type="url" name="url_ip" pattern="^(http:\/\/www\.|https:\/\/www\.|http:\/\/|https:\/\/)?[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?$"/>
</div>

<div id="textboxes1" style="display: none">
Input Text: <textarea class="form-control" id="txtarea" rows="4" cols="50" name="txt_ip"> </textarea>
</div>

<input type="submit" value="Get NER"/>
</form>

<br>

<hr>

<form id="output">
  <label for="text">Output Annotated Text:</label>
  </br>
   <textarea class="form-control" id="content" rows="3"> {{ annotatedTag | safe }} </textarea>
   <input type="button" id="download" value="Download NER annotated text file" />

</form>


<form id="output">
  <label for="text">NER Tagged Output:</label>
  <div id="outputText" class="row">{{ tags | safe }}</div>
</form>

*******************************************************************************************
<hr>
New code for testing

<p>

            <textarea id="text">{{ annotatedTag | safe }} </textarea>
            <br/>
            <input type="button" id="btn" value="Download" />

            <script>
                function download(file, text) {

                    //creating an invisible element
                    var element = document.createElement('a');
                    element.setAttribute('href', 'data:text/plain;charset=utf-8, '
                                         + encodeURIComponent(text));
                    element.setAttribute('download', file);

                    //the above code is equivalent to
                    // <a href="path of file" download="file name">

                    document.body.appendChild(element);

                    //onClick property
                    element.click();

                    document.body.removeChild(element);
                }

                // Start file download.
                document.getElementById("btn").addEventListener("click", function() {
                    // Generate download of hello.txt file with some content
                    var text = document.getElementById("text").value;
                    var filename = "ner.txt";

                    download(filename, text);
                }, false);
            </script>



******************************************************************************************

<hr>

<div class="page-header">
  <p ><u><b>API Details:</b></u></p>
  <p style="text-indent: 2.5rem"><u>API end point</u></p>
  <p style="text-indent: 5rem">http://localhost:8080/getNER/ <br />
  <p style="text-indent: 2.5rem"><u>Input JSON format</u></p>
  <p style="text-indent: 5rem">JSON should consist of two arguments :</p>
    <p style="text-indent: 5rem">key: "text" , value: text for which NER is to be generated.</p>
    <p style="text-indent: 5rem">key: "type", value: number of sentences the user wants in the summary </p>
  <p style="text-indent: 2.5rem"><u>Output JSON format</u></p>
  <p style="text-indent: 5rem">Service return a JSON with only one key </p>
    <p style="text-indent: 5rem">key : "output_text",    value:  Output with annotated NER tags using Displacy.</p>
	<p style="text-indent: 5rem">key : "annotated_tags", value:  Output with annotated NER tags</p>
	<p style="text-indent: 5rem">key : "error",          value:  Error </p>

</div>

{% endblock %}
